<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>꽃게당 인스타그램 TV - 4K UHD 플레이어</title>
  <style>
    /* 완전 풀스크린 - 좌우 여백 완전 제거 */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    
    html, body {
      width: 100vw;
      height: 100vh;
      background: #000;
      overflow: hidden;
      position: relative;
    }

    /* 스테이지: 화면 전체를 꽉 채움 */
    #stage {
      position: absolute;
      top: 0;
      left: 0;
      width: 100vw;
      height: calc(100vw * 9 / 16);
      max-width: 3840px;
      max-height: 2160px;
      background: #000;
      box-shadow: 0 0 0 2px rgba(255,255,255,0.03);
      transform-origin: top left;
    }

    /* 세로 화면일 때 */
    @media screen and (max-aspect-ratio: 16/9) {
      #stage {
        width: calc(100vh * 16 / 9);
        height: 100vh;
        max-width: 100vw;
      }
    }

    /* 4K 모니터 */
    @media screen and (min-width: 3840px) {
      #stage {
        width: 3840px;
        height: 2160px;
        left: 50%;
        transform: translateX(-50%);
      }
    }

    /* iframe: 스테이지 꽉 채움 */
    #viewer {
      width: 100% !important;
      height: 100% !important;
      border: none;
      display: block;
      opacity: 1;
      transition: opacity 0.9s;
      background: #000;
      position: absolute;
      top: 0;
      left: 0;
    }
    #viewer.fadeout {
      opacity: 0;
    }

    @media (max-width: 640px) {
      #stage { box-shadow: none; }
    }
  </style>
</head>
<body>
  <div id="stage">
    <iframe id="viewer" src=""></iframe>
  </div>

<script>
  const BASE_W = 3840;
  const BASE_H = 2160;
  const stage = document.getElementById('stage');
  const viewer = document.getElementById('viewer');

  // 완전 풀스크린 맞춤 (transform 제거)
  function fitToScreen() {
    // CSS로 이미 완벽하게 맞춰져 있으므로 transform 불필요
  }

  window.addEventListener('resize', fitToScreen);
  window.addEventListener('orientationchange', fitToScreen);

  // 페이지 전환 로직 (기존 그대로)
  const pages = ["kkgd_high_res_board1.html", "kkgd_high_res_board2.html", "kkgd_high_res_board3.html", "kkgd_high_res_video.html", "kkgd_high_res_promo.html"];
  const intervals = [20000, 30000, 10000, 90000, 40000];
  let current = 0;
  let timeoutId = null;

  const PRELOAD_RANGE = 2;
  const preloaded = new Set();

  function preloadNextPages(startIdx) {
    for (let i = 1; i <= PRELOAD_RANGE; i++) {
      let idx = (startIdx + i) % pages.length;
      let page = pages[idx];
      if (!preloaded.has(page)) {
        const link = document.createElement('link');
        link.rel = 'preload';
        link.href = page;
        link.as = 'document';
        document.head.appendChild(link);
        preloaded.add(page);
      }
    }
  }

  function nextPage() {
    viewer.classList.add('fadeout');
    setTimeout(() => {
      current = (current + 1) % pages.length;
      viewer.src = pages[current];
      preloadNextPages(current);
    }, 900);
  }

  function startInterval() {
    clearTimeout(timeoutId);
    timeoutId = setTimeout(nextPage, intervals[current]);
  }
  function stopInterval() {
    clearTimeout(timeoutId);
    timeoutId = null;
  }

  viewer.addEventListener('load', function() {
    viewer.classList.remove('fadeout');
    startInterval();
  });

  document.addEventListener("visibilitychange", function() {
    if (document.hidden) {
      stopInterval();
    } else {
      startInterval();
    }
  });

  window.addEventListener("beforeunload", stopInterval);

  window.addEventListener('keydown', (e) => {
    if (e.key === 'ArrowRight') {
      stopInterval();
      nextPage();
    } else if (e.key === 'ArrowLeft') {
      stopInterval();
      viewer.classList.add('fadeout');
      setTimeout(() => {
        current = (current - 1 + pages.length) % pages.length;
        viewer.src = pages[current];
        preloadNextPages(current);
      }, 900);
    }
  });

  function init() {
    current = 0;
    viewer.src = pages[current];
    preloadNextPages(0);
    fitToScreen();
  }

  window.addEventListener('load', init);
</script>
</body>
</html>
